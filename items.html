<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1\" />
  <title>إدخال المواد - مطور</title>
  <link rel="stylesheet" href="./css/app.css?v=7" />
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>إدخال المواد</h1>
    <nav class="card">
      <a href="./items.html">المواد</a>
      <a href="./purchases.html">مشتريات</a>
      <a href="./sales.html">مبيعات</a>
      <a href="./inventory.html">متابعة المخزون</a>
    </nav>

    <div class="card">
      <form id="itemForm">
        <input type="hidden" id="editId" value="" />
        <div class="grid">
          <div>
            <label>صنف أساسي</label>
            <input id="main_category" list="mainList" required />
            <datalist id="mainList"></datalist>
          </div>
          <div>
            <label>صنف فرعي</label>
            <input id="sub_category" list="subList" required />
            <datalist id="subList"></datalist>
          </div>
          <div>
            <label>اسم الصنف</label>
            <input id="item_name" list="nameList" required />
            <datalist id="nameList"></datalist>
          </div>
          <div>
            <label>رقم اللون</label>
            <input id="color_code" required />
          </div>
          <div>
            <label>اسم اللون</label>
            <input id="color_name" required />
          </div>
          <div>
            <label>الوحدة</label>
            <select id="unit_type">
              <option value="kg">كيلو (kg)</option>
              <option value="m">متر (m)</option>
            </select>
          </div>
          <div class="span-all">
            <label>الشرح (اختياري)</label>
            <textarea id="description" rows="2"></textarea>
          </div>
          <div>
            <label>صورة المادة</label>
            <input type="file" id="image_file" accept="image/*" />
          </div>
        </div>
        <div class="toolbar" style="margin-top:1rem;">
          <button type="submit" class="primary">حفظ المادة</button>
          <button type="button" id="btnCancel" class="secondary">إلغاء</button>
          <div style="flex:1"></div>
          <button type="button" id="btnBulk" class="secondary">إضافة جماعية / Excel</button>
        </div>
        <div id="msg"></div>
      </form>
    </div>

    <div id="bulkModal" class="modal-overlay" style="display:none;">
      <div class="modal-content" style="max-width:900px;">
        <div class="modal-header">
          <h3>استيراد مواد (Excel أو لصق نصي)</h3>
          <button id="bulkClose" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="grid">
            <div>
              <label>1. اختر ملف Excel (.xlsx / .csv)</label>
              <input type="file" id="bulkFile" accept=".xlsx, .xls, .csv" />
            </div>
            <div>
              <label>أو 2. الصق البيانات هنا (صنف|فرعي|اسم|كود|لون|وحدة|شرح)</label>
              <textarea id="bulkText" placeholder="مثال: قطن|سنجل|ليكرا|101|أسود|kg|وصف" rows="3"></textarea>
            </div>
          </div>

          <div class="toolbar" style="margin-top:10px;">
            <button id="bulkPreview" class="primary">معاينة وفحص البيانات</button>
            <button id="bulkClear" class="secondary">مسح</button>
            <div style="flex:1"></div>
            <button id="bulkApply" class="success" style="display:none; background-color: #2ecc71; color:white;">اعتماد وحفظ البيانات الجاهزة</button>
          </div>

          <div id="bulkMsg" style="margin:10px 0; font-weight:bold;"></div>

          <div class="tableWrap" style="max-height:300px; overflow-y:auto;">
            <table class="small-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>الحالة</th>
                  <th>المادة</th>
                  <th>الكود</th>
                  <th>اللون</th>
                  <th>الوحدة</th>
                  <th>الشرح</th>
                </tr>
              </thead>
              <tbody id="bulkTbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:20px;">
      <div class="toolbar">
        <input id="search" placeholder="بحث..." />
        <label><input type="checkbox" id="showAll" /> الكل</label>
        <button id="btnReload" class="secondary">تحديث</button>
      </div>
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>صورة</th>
              <th>المادة</th>
              <th>رقم اللون</th>
              <th>اسم اللون</th>
              <th>الوحدة</th>
              <th>الشرح</th>
              <th>الحالة</th>
              <th>إجراءات</th>
            </tr>
          </thead>
          <tbody id="itemsTbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module" src="./js/items.js?v=8"></script>
</body>
</html>
